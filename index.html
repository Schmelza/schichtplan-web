<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Schichtkalender (ICS) â€“ Web Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body{
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Arial;
      background:#f5f6fa;
      margin:0;
      padding:30px;
    }
    h1{
      text-align:center;
      margin-bottom:24px;
    }
    .box{
      max-width:520px;
      margin:0 auto;
      background:#fff;
      border-radius:14px;
      padding:24px;
      box-shadow:0 10px 30px rgba(0,0,0,.08);
    }
    label{
      display:block;
      font-weight:600;
      margin-bottom:6px;
    }
    select,input{
      width:100%;
      padding:12px;
      border-radius:10px;
      border:1px solid #ccc;
      margin-bottom:16px;
      font-size:16px;
    }
    button{
      width:100%;
      padding:14px;
      font-size:16px;
      border-radius:12px;
      border:none;
      cursor:pointer;
      font-weight:600;
    }
    #generate{
      background:#0d6efd;
      color:#fff;
    }
    .secondary{
      background:#555;
      color:#fff;
      margin-top:10px;
    }
    .error{
      margin-top:14px;
      color:#c00;
      font-weight:600;
      text-align:center;
    }
    .result{
      margin-top:20px;
      padding:14px;
      background:#f0f3ff;
      border-radius:10px;
      font-size:14px;
      word-break:break-all;
    }
  </style>
</head>

<body>

<h1>Schichtkalender (ICS) â€“ Web Generator</h1>

<div class="box">

  <label for="fiber">Fiber</label>
  <select id="fiber">
    <option value="1">Fiber 1</option>
    <option value="2">Fiber 2</option>
  </select>

  <label for="team">Team</label>
  <select id="team">
    <option value="1">Team 1 (P1)</option>
    <option value="2">Team 2 (P2)</option>
    <option value="3">Team 3 (P3)</option>
    <option value="4">Team 4 (P4)</option>
  </select>

  <label for="year">Jahr</label>
  <input id="year" type="number">

  <button id="generate">Generieren (ICS)</button>

  <button id="printv1" class="secondary">ðŸ–¨ Druckversion V1 (untereinander)</button>
  <button id="printv2" class="secondary">ðŸ–¨ Druckversion V2 (nebeneinander)</button>

  <div id="error" class="error"></div>
  <div id="result" class="result" style="display:none"></div>

</div>

<script>
  const yearInput = document.getElementById("year");
  const nowYear = new Date().getFullYear();
  yearInput.min = nowYear;
  yearInput.max = nowYear + 4;
  yearInput.value = nowYear;

  const errorBox  = document.getElementById("error");
  const resultBox = document.getElementById("result");

  function params() {
    const fiber = document.getElementById("fiber").value;
    const team  = document.getElementById("team").value;
    const year  = document.getElementById("year").value;
    return { fiber, team, year };
  }

  document.getElementById("generate").addEventListener("click", async () => {
    errorBox.textContent = "";
    resultBox.style.display = "none";

    const { fiber, team, year } = params();

    const res = await fetch(`/generate?fiber=${fiber}&team=${team}&year=${year}`);
    const text = await res.text();

    if (!res.ok) {
      errorBox.textContent = text;
      return;
    }

    const data = JSON.parse(text);

    resultBox.style.display = "block";
    resultBox.innerHTML = `
      <strong>ICS:</strong><br>
      <a href="${data.ics}" target="_blank">${data.ics}</a><br><br>
      <strong>iOS / Apple Kalender:</strong><br>
      <code>${data.webcal}</code>
    `;
  });

  document.getElementById("printv1").addEventListener("click", () => {
    const { fiber, team, year } = params();
    window.open(`/print-v1.html?fiber=${fiber}&team=${team}&year=${year}`, "_blank");
  });

  document.getElementById("printv2").addEventListener("click", () => {
    const { fiber, team, year } = params();
    window.open(`/print-v2.html?fiber=${fiber}&team=${team}&year=${year}`, "_blank");
  });
</script>

</body>
</html>
