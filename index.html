<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Huhtamaki Fiber Schichtkalender Generator</title>

  <link rel="icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#2563eb">

  <style>
    /* (Style unverändert, bewusst gekürzt) */
  </style>
</head>

<body>
  <!-- HINWEIS: Inhalt ist identisch zu deiner bisherigen Seite -->
  <!-- Nur Counter-Logik ist final korrekt -->

  <div id="genCounter" style="text-align:center;font-size:12px;margin-top:6px;">
    Generierungen insgesamt: 0
  </div>

<script>
(function(){

  async function loadGlobalCounter(){
    try{
      const res = await fetch('/counter?mode=view&key=huhtamaki_generator', { cache:'no-store' });
      if(!res.ok) return;
      const data = await res.json();
      updateCounterView(data.value);
    }catch(e){}
  }

  async function incrementGlobalCounter(){
    try{
      const res = await fetch('/counter?mode=inc&key=huhtamaki_generator', { cache:'no-store' });
      if(!res.ok) return;
      const data = await res.json();
      updateCounterView(data.value);
    }catch(e){}
  }

  function updateCounterView(value){
    const el = document.getElementById('genCounter');
    if(el && typeof value === 'number'){
      el.textContent = 'Generierungen insgesamt: ' + value;
    }
  }

  loadGlobalCounter();

  // ⬇️ WICHTIG: DIESER AUFRUF MUSS BEI ERFOLGREICHER GENERIERUNG ERFOLGEN
  window.incrementGlobalCounter = incrementGlobalCounter;

})();
</script>

<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("/sw.js").catch(()=>{});
    });
  }
</script>

</body>
</html>
