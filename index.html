<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Huhtamaki Fiber Schicht Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, sans-serif; background:#f6f7f9; }
    .box { max-width:700px; margin:40px auto; background:#fff; padding:24px; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.08); }
    h1 { text-align:center; margin-bottom:24px; }
    label { font-weight:600; display:block; margin-top:16px; }
    select, button { width:100%; padding:10px; margin-top:6px; border-radius:8px; border:1px solid #ccc; }
    .row { display:flex; gap:16px; }
    .row > div { flex:1; }
    .actions { margin-top:24px; display:flex; gap:12px; flex-wrap:wrap; }
    button.primary { background:#2563eb; color:#fff; border:none; }
    button.secondary { background:#f1f5f9; border:none; }
    .error { color:#b91c1c; margin-top:12px; font-weight:600; }
    .hint { font-size:13px; color:#555; margin-top:12px; }
  </style>
</head>
<body>

<div class="box">
  <h1>Huhtamaki Fiber Schicht Generator</h1>

  <div class="row">
    <div>
      <label for="department">Abteilung</label>
      <select id="department"></select>
    </div>
    <div>
      <label for="shift">Schicht</label>
      <select id="shift"></select>
    </div>
  </div>

  <label for="year">Jahr</label>
  <select id="year"></select>
  <div id="yearInfo" class="hint"></div>

  <div class="actions">
    <button class="primary" id="btnGenerate">Generieren</button>
    <button class="secondary" id="btnPrintV1">Druck Monat untereinander</button>
    <button class="secondary" id="btnPrintV2">Druck Monat nebeneinander</button>
  </div>

  <div id="error" class="error"></div>
</div>

<script>
/* ===============================
   1. KONFIG
================================ */
const STRUCTURE = {
  "Fiber 2": ["P1", "P2", "P3"],
  "Fiber 3": ["P1", "P2"]
};

/* ===============================
   2. ELEMENTE
================================ */
const depSel = document.getElementById("department");
const shiftSel = document.getElementById("shift");
const yearSel = document.getElementById("year");
const errorBox = document.getElementById("error");
const yearInfo = document.getElementById("yearInfo");

/* ===============================
   3. ABTEILUNG â†’ SCHICHT
================================ */
function fillDepartments() {
  depSel.innerHTML = "";
  Object.keys(STRUCTURE).forEach(dep => {
    const o = document.createElement("option");
    o.value = dep;
    o.textContent = dep;
    depSel.appendChild(o);
  });
}

function fillShifts(dep) {
  shiftSel.innerHTML = "";
  STRUCTURE[dep].forEach(s => {
    const o = document.createElement("option");
    o.value = s;
    o.textContent = s;
    shiftSel.appendChild(o);
  });
}

depSel.addEventListener("change", () => {
  fillShifts(depSel.value);
});

/* ===============================
   4. YEAR RANGE (SERVER)
================================ */
async function loadYearRange() {
  try {
    const r = await fetch("/range");
    const j = await r.json();
    populateYears(j.min, j.max);
    yearInfo.textContent = `Erlaubt: ${j.min} bis ${j.max}`;
  } catch {
    populateYears(2026, 2030);
    yearInfo.textContent = "Erlaubt: 2026 bis 2030 (Fallback)";
  }
}

function populateYears(min, max) {
  yearSel.innerHTML = "";
  for (let y = min; y <= max; y++) {
    const o = document.createElement("option");
    o.value = y;
    o.textContent = y;
    yearSel.appendChild(o);
  }
}

/* ===============================
   5. ACTIONS
================================ */
function buildUrl(type) {
  const p = new URLSearchParams({
    department: depSel.value,
    shift: shiftSel.value,
    year: yearSel.value
  });
  return type === "gen"
    ? `/generate?${p}`
    : `/print${type}?${p}`;
}

document.getElementById("btnGenerate").onclick = () => location.href = buildUrl("gen");
document.getElementById("btnPrintV1").onclick = () => location.href = buildUrl("v1");
document.getElementById("btnPrintV2").onclick = () => location.href = buildUrl("v2");

/* ===============================
   6. INIT
================================ */
fillDepartments();
fillShifts(Object.keys(STRUCTURE)[0]);
loadYearRange();
</script>

</body>
</html>